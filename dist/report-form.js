var a=o=>new Promise(t=>setTimeout(t,o));var s=({selector:o,parent:t,log:e="debug"})=>{let r=(t||document).querySelector(o);return r===null?(e===!1||(e==="debug"?console.debug:console.error)(`${e.toUpperCase()}: Element with selector "${o}" not found in ${t!==void 0?"the specified parent element:":"the document."}`,t),null):r};window.wfCustomPageLoadFeatures||(window.wfCustomPageLoadFeatures={});var i="#wf-form-Multi-Step---Report-Damage",l=async(o,t)=>{try{let e=await fetch(`${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formResponseId:o})});if(!e.ok){let n=await e.json();console.error("Error while fetching form data for GTM:",n.error),console.error("Response status:",e.status);return}return await e.json().then(n=>n.data)}catch(e){let r=e instanceof Error?e.message:String(e);throw new Error("Something went wrong while fetching form data for Google Tag Manager! "+r)}},m=()=>{let o=s({selector:"[data-api-url]"})?.getAttribute("data-api-url");if(!o){console.error("API URL not found in data-api-url attribute");return}window.addEventListener("message",async t=>{if(t.origin==="https://form.typeform.com"){if(!t.data){console.error("No data in message event from Typeform");return}if(t.data.type==="form-submit"){let e=t.data.responseId;await a(2e3);let r=await l(e,o);if(!r){console.error("ERROR: FORM DATA wasn't available when this request was made.");return}let n={email:r.email,phone_number:r.phoneNumber,address:{first_name:r.name.split(" ")[0]||"",last_name:r.name.split(" ").slice(1).join(" ")||""}};console.debug(n,"targetData"),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"form_submit","gtm.elementId":i,user_data:n})}}})};m();
