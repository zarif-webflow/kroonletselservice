var a=t=>new Promise(e=>setTimeout(e,t));var s=({selector:t,parent:e,log:r="debug"})=>{let o=(e||document).querySelector(t);return o===null?(r===!1||(r==="debug"?console.debug:console.error)(`${r.toUpperCase()}: Element with selector "${t}" not found in ${e!==void 0?"the specified parent element:":"the document."}`,e),null):o};window.wfCustomPageLoadFeatures||(window.wfCustomPageLoadFeatures={});var i="#wf-form-Multi-Step---Report-Damage",l=async(t,e)=>{try{let r=await fetch(`${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formResponseId:t})});if(!r.ok){let n=await r.json();console.error("Error while fetching form data for GTM:",n.error);return}return await r.json().then(n=>n.data)}catch{throw new Error("Something went wrong while fetching form data for Google Tag Manager!")}},m=()=>{let t=s({selector:"[data-api-url]"})?.getAttribute("data-api-url");if(!t){console.error("API URL not found in data-api-url attribute");return}window.addEventListener("message",async e=>{if(e.origin==="https://form.typeform.com"){if(!e.data){console.error("No data in message event from Typeform");return}if(e.data.type==="form-submit"){let r=e.data.responseId;await a(2e3);let o=await l(r,t);if(!o){console.error("ERROR: FORM DATA wasn't available when this request was made.");return}let n={email:o.email,phone_number:o.phoneNumber,address:{first_name:o.name.split(" ")[0]||"",last_name:o.name.split(" ").slice(1).join(" ")||""}};console.debug(n,"targetData"),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"form_submit","gtm.elementId":i,user_data:n})}}})};m();
