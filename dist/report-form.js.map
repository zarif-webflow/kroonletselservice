{
  "version": 3,
  "sources": ["../node_modules/.pnpm/@finsweet+ts-utils@0.40.0/node_modules/@finsweet/ts-utils/dist/helpers/wait.js", "../node_modules/.pnpm/@taj-wf+utils@1.3.0/node_modules/@taj-wf/utils/dist/index.js", "../src/features/report-form.ts"],
  "sourcesContent": ["/**\n * @returns Awaitable promise for waiting X time.\n * @param time\n */\nexport const wait = (time) => new Promise((resolve) => setTimeout(resolve, time));\n", "// src/modules/after-webflow-ready.ts\nvar afterWebflowReady = (callback) => {\n  window.Webflow ||= [];\n  window.Webflow.push(callback);\n};\n\n// src/modules/get-html-element.ts\nvar getHtmlElement = ({\n  selector,\n  parent,\n  log = \"debug\"\n}) => {\n  const targetElement = (parent || document).querySelector(selector);\n  if (targetElement === null) {\n    if (log === false) return null;\n    const consoleMethod = log === \"debug\" ? console.debug : console.error;\n    consoleMethod(\n      `${log.toUpperCase()}: Element with selector \"${selector}\" not found in ${parent !== void 0 ? \"the specified parent element:\" : \"the document.\"}`,\n      parent\n    );\n    return null;\n  }\n  return targetElement;\n};\nvar getMultipleHtmlElements = ({\n  selector,\n  parent,\n  log = \"debug\"\n}) => {\n  const targetElements = Array.from((parent || document).querySelectorAll(selector));\n  if (targetElements.length === 0) {\n    if (log === false) return null;\n    const consoleMethod = log === \"debug\" ? console.debug : console.error;\n    consoleMethod(\n      `${log.toUpperCase()}: No elements found with selector \"${selector}\" in ${parent !== void 0 ? \"the specified parent element:\" : \"the document.\"}`,\n      parent\n    );\n    return null;\n  }\n  return targetElements;\n};\n\n// src/modules/get-active-script.ts\nvar getActiveScript = (importMetaUrl) => {\n  const currentModuleUrl = importMetaUrl;\n  return getHtmlElement({\n    selector: `script[src=\"${currentModuleUrl}\"]`\n  });\n};\n\n// src/modules/get-gsap.ts\nvar getGsap = (plugins = [], log = \"error\") => {\n  let gsapInstance = null;\n  const logFunc = log === \"debug\" ? console.debug : log === \"error\" ? console.error : null;\n  try {\n    gsapInstance = gsap;\n  } catch {\n    logFunc?.(\n      \"GSAP script needs to be imported before this script.\",\n      \"\\n\",\n      \"Get GSAP from here: https://gsap.com/docs/v3/Installation/ \"\n    );\n  }\n  const result = [gsapInstance];\n  for (let i = 0; i < plugins.length; i++) {\n    const plugin = plugins[i];\n    let pluginInstance = null;\n    try {\n      pluginInstance = window[plugin] || null;\n      if (!pluginInstance) {\n        throw new Error();\n      }\n    } catch {\n      logFunc?.(\n        `GSAP ${plugin} plugin script needs to be imported before this script.`,\n        \"\\n\",\n        `Get the ${plugin} plugin from here: https://gsap.com/docs/v3/Installation/ `\n      );\n    }\n    result[i + 1] = pluginInstance;\n  }\n  return result;\n};\n\n// src/modules/set-style.ts\nvar setStyle = (element, styles) => {\n  const prevValues = {};\n  for (const key of Object.keys(styles)) {\n    prevValues[key] = element.style[key];\n    element.style[key] = styles[key] || \"\";\n  }\n  return {\n    revert: () => {\n      Object.assign(element.style, prevValues);\n    }\n  };\n};\n\n// src/modules/wf-custom-page-load-features.ts\nwindow.wfCustomPageLoadFeatures ||= {};\nvar addWFCustomPageLoadFeature = (feature) => {\n  window.wfCustomPageLoadFeatures ||= {};\n  window.wfCustomPageLoadFeatures[feature.name] = feature;\n};\nvar getWFCustomPageLoadFeatures = () => window.wfCustomPageLoadFeatures;\n\nexport { addWFCustomPageLoadFeature, afterWebflowReady, getActiveScript, getGsap, getHtmlElement, getMultipleHtmlElements, getWFCustomPageLoadFeatures, setStyle };\n", "import { wait } from \"@finsweet/ts-utils\";\nimport { getHtmlElement } from \"@taj-wf/utils\";\n\nconst formId = \"#wf-form-Multi-Step---Report-Damage\";\n\nconst getFormData = async (responseId: string, apiURL: string) => {\n  try {\n    const response = await fetch(`${apiURL}`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ formResponseId: responseId }),\n    });\n    if (!response.ok) {\n      const data = await response.json();\n      console.error(\"Error while fetching form data for GTM:\", data.error);\n      return;\n    }\n    const data = await response.json().then((res) => res.data);\n\n    return data as { name: string; email: string; phoneNumber: string };\n  } catch {\n    throw new Error(\"Something went wrong while fetching form data for Google Tag Manager!\");\n  }\n};\n\ntype TargetDataType = {\n  email: string;\n  phone_number: string | undefined;\n  address: {\n    first_name: string;\n    last_name: string;\n  };\n};\n\nconst init = () => {\n  const apiUrl = getHtmlElement({ selector: \"[data-api-url]\" })?.getAttribute(\"data-api-url\");\n  if (!apiUrl) {\n    console.error(\"API URL not found in data-api-url attribute\");\n    return;\n  }\n\n  window.addEventListener(\"message\", async (event) => {\n    if (event.origin !== \"https://form.typeform.com\") return;\n\n    if (!event.data) {\n      console.error(\"No data in message event from Typeform\");\n      return;\n    }\n\n    if (event.data.type === \"form-submit\") {\n      const responseId = event.data.responseId;\n\n      // wait for 2 seconds to ensure the data is available in the backend\n      await wait(2000);\n\n      const formData = await getFormData(responseId, apiUrl);\n\n      if (!formData) return;\n\n      const targetData: TargetDataType = {\n        email: formData.email,\n        phone_number: formData.phoneNumber,\n        address: {\n          first_name: formData.name.split(\" \")[0] || \"\",\n          last_name: formData.name.split(\" \").slice(1).join(\" \") || \"\",\n        },\n      };\n\n      console.debug(targetData, \"targetData\");\n\n      window.dataLayer = window.dataLayer || [];\n      window.dataLayer.push({\n        event: \"form_submit\",\n        \"gtm.elementId\": formId,\n        user_data: targetData,\n      });\n    }\n  });\n};\n\ninit();\n"],
  "mappings": ";;;AAIO,IAAM,OAAO,CAAC,SAAS,IAAI,QAAQ,CAAC,YAAY,WAAW,SAAS,IAAI,CAAC;;;ACGhF,IAAI,iBAAiB,CAAC;AAAA,EACpB;AAAA,EACA;AAAA,EACA,MAAM;AACR,MAAM;AACJ,QAAM,iBAAiB,UAAU,UAAU,cAAc,QAAQ;AACjE,MAAI,kBAAkB,MAAM;AAC1B,QAAI,QAAQ,MAAO,QAAO;AAC1B,UAAM,gBAAgB,QAAQ,UAAU,QAAQ,QAAQ,QAAQ;AAChE;AAAA,MACE,GAAG,IAAI,YAAY,CAAC,4BAA4B,QAAQ,kBAAkB,WAAW,SAAS,kCAAkC,eAAe;AAAA,MAC/I;AAAA,IACF;AACA,WAAO;AAAA,EACT;AACA,SAAO;AACT;AA4EA,OAAO,6BAA6B,CAAC;;;AChGrC,IAAM,SAAS;AAEf,IAAM,cAAc,OAAO,YAAoB,WAAmB;AAChE,MAAI;AACF,UAAM,WAAW,MAAM,MAAM,GAAG,MAAM,IAAI;AAAA,MACxC,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,gBAAgB,WAAW,CAAC;AAAA,IACrD,CAAC;AACD,QAAI,CAAC,SAAS,IAAI;AAChB,YAAMA,QAAO,MAAM,SAAS,KAAK;AACjC,cAAQ,MAAM,2CAA2CA,MAAK,KAAK;AACnE;AAAA,IACF;AACA,UAAM,OAAO,MAAM,SAAS,KAAK,EAAE,KAAK,CAAC,QAAQ,IAAI,IAAI;AAEzD,WAAO;AAAA,EACT,QAAQ;AACN,UAAM,IAAI,MAAM,uEAAuE;AAAA,EACzF;AACF;AAWA,IAAM,OAAO,MAAM;AACjB,QAAM,SAAS,eAAe,EAAE,UAAU,iBAAiB,CAAC,GAAG,aAAa,cAAc;AAC1F,MAAI,CAAC,QAAQ;AACX,YAAQ,MAAM,6CAA6C;AAC3D;AAAA,EACF;AAEA,SAAO,iBAAiB,WAAW,OAAO,UAAU;AAClD,QAAI,MAAM,WAAW,4BAA6B;AAElD,QAAI,CAAC,MAAM,MAAM;AACf,cAAQ,MAAM,wCAAwC;AACtD;AAAA,IACF;AAEA,QAAI,MAAM,KAAK,SAAS,eAAe;AACrC,YAAM,aAAa,MAAM,KAAK;AAG9B,YAAM,KAAK,GAAI;AAEf,YAAM,WAAW,MAAM,YAAY,YAAY,MAAM;AAErD,UAAI,CAAC,SAAU;AAEf,YAAM,aAA6B;AAAA,QACjC,OAAO,SAAS;AAAA,QAChB,cAAc,SAAS;AAAA,QACvB,SAAS;AAAA,UACP,YAAY,SAAS,KAAK,MAAM,GAAG,EAAE,CAAC,KAAK;AAAA,UAC3C,WAAW,SAAS,KAAK,MAAM,GAAG,EAAE,MAAM,CAAC,EAAE,KAAK,GAAG,KAAK;AAAA,QAC5D;AAAA,MACF;AAEA,cAAQ,MAAM,YAAY,YAAY;AAEtC,aAAO,YAAY,OAAO,aAAa,CAAC;AACxC,aAAO,UAAU,KAAK;AAAA,QACpB,OAAO;AAAA,QACP,iBAAiB;AAAA,QACjB,WAAW;AAAA,MACb,CAAC;AAAA,IACH;AAAA,EACF,CAAC;AACH;AAEA,KAAK;",
  "names": ["data"]
}
